<header title="Deployment" title-addition="{{$ctrl.data.name}}">

</header>

<div class="container-fluid" ng-show="$ctrl.data">
  <div class="row chart-row">
    <!--<live-bar-chart class="col-md-8" ng-if="$ctrl.data.name" base="deployments:{{$ctrl.data.name}}" bar-width="60"></live-bar-chart>-->
    <div class="col-md-6">
      <h4 class="chart-header">&nbsp;Health (%)</h4>
      <canvas id="bar" class="chart chart-bar"
              chart-data="$ctrl.chart.data" chart-options="$ctrl.chart.options" chart-labels="$ctrl.chart.labels" chart-series="$ctrl.chart.series" chart-colors="$ctrl.chart.colors">
      </canvas>

    </div>

    <div class="status-col">
      <status class="status-circle" value="$ctrl.currentHealth"></status>
      <p class="status-text">{{$ctrl.currentHealth | number: 0}}%</p>
    </div>
  </div>

  <div class="row">
    <div class="col-md-12">
      <div class="panel panel-default" ng-repeat="(clustername, cluster) in $ctrl.data.clusters">
        <div class="panel-heading">
          <div class="row">
            <div class="col-md-3 column">
              <span class="head">{{clustername}}</span>
              &nbsp;
              <span class="category">Cluster</span>
            </div>
            <div class="col-md-2 column">
              <span class="panel-label">Scale</span>
            </div>
            <div class="col-md-2 column">
              <span class="panel-label">Instances</span>
            </div>
            <div class="col-md-2 column">
              <span class="panel-label">Environment Variables</span>
            </div>
            <div class="col-md-2 column">
              <span class="panel-label">Ports</span>
            </div>

            <div class="col-md-1 column">
              <span class="panel-label">Status</span>
            </div>
          </div>
        </div>

        <div class="panel-body">
          <div class="row service-row" ng-repeat="service in cluster.services">
            <div class="col-md-3">
              <p class="head">{{service.breed.name}}</p>
              <p class="sub-head">
                {{service.breed.deployable.definition}}
              </p>
            </div>
            <div class="col-md-2">
              <p>
                <span class="panel-label">Instances: </span>

                <span ng-hide="$ctrl.editInstances[service.breed.name]">
                  <span highlighter="service.scale.instances">{{service.scale.instances}}</span>&nbsp;
                  <i ng-click="$ctrl.editNumberOfInstances(service.breed.name, service.scale.instances)" class="fa fa-pencil" aria-hidden="true"></i>
                </span>

                <span ng-show="$ctrl.editInstances[service.breed.name]">
                  <input class="input-small" size="2" maxlength="2" step="1" type="number" min="1" ng-model="$ctrl.initialNumberOfInstances[service.breed.name]">
                  <button ng-disabled="!$ctrl.initialNumberOfInstances[service.breed.name]" ng-click="$ctrl.saveNumberOfInstances(service.breed.name, service.scale, $ctrl.initialNumberOfInstances[service.breed.name])">
                    <i class="fa fa-check"></i>
                  </button>
                  <button ng-click="$ctrl.editInstances[service.breed.name] = false; $ctrl.editCancel()">
                    <i class="fa fa-times"></i>
                  </button>
                </span>
              </p>

              <p>
                <span class="panel-label">Cpu: </span>

                <span ng-hide="$ctrl.editCpu[service.breed.name]">
                  <span highlighter="service.scale.cpu">{{service.scale.cpu}}</span>&nbsp;
                  <i ng-click="$ctrl.editNumberOfCpus(service.breed.name, service.scale.cpu)" class="fa fa-pencil" aria-hidden="true"></i>
                </span>

                <span ng-show="$ctrl.editCpu[service.breed.name]">
                  <input class="input-small" maxlength="4" step="0.1" type="number" min="0" ng-model="$ctrl.initialNumberOfCpus[service.breed.name]">
                  <button ng-click="$ctrl.saveNumberOfCpus(service.breed.name, service.scale, $ctrl.initialNumberOfCpus[service.breed.name])">
                    <i class="fa fa-check"></i>
                  </button>
                  <button ng-click="$ctrl.editCpu[service.breed.name] = false; $ctrl.editCancel()">
                    <i class="fa fa-times"></i>
                  </button>
                </span>
              </p>
              <p>
                <span class="panel-label">Memory: </span>

                <span ng-hide="$ctrl.editMemory[service.breed.name]">
                  <span highlighter="service.scale.memory">{{service.scale.memory}}</span>&nbsp;
                  <i ng-click="$ctrl.editSizeOfMemory(service.breed.name, service.scale.memory)" class="fa fa-pencil" aria-hidden="true"></i>
                </span>

                <span ng-show="$ctrl.editMemory[service.breed.name]">
                  <input  maxlength="10" size="10" type="input" min="0" ng-model="$ctrl.initialSizeOfMemory[service.breed.name]">

                  <button ng-disabled="$ctrl.memoryToNumber($ctrl.initialSizeOfMemory[service.breed.name]) < 1" ng-click="$ctrl.saveSizeOfMemory(service.breed.name, service.scale, $ctrl.initialSizeOfMemory[service.breed.name])">
                    <i class="fa fa-check"></i>
                  </button>
                  <button ng-click="$ctrl.editMemory[service.breed.name] = false; $ctrl.editCancel()">
                    <i class="fa fa-times"></i>
                  </button>
                </span>
              </p>

            </div>
            <div class="col-md-2">

              <div class="instance" ng-repeat="instance in service.instances">
                <div>{{instance.host}}:</div>


                  <span ng-repeat="(portname, port) in instance.ports">{{port}}<span ng-if="!$last">/</span></span>

              </div>
            </div>
            <div class="col-md-2">
              <div ng-repeat="(evKey, evVariable) in service.environment_variables">
                <p>{{evKey}}:</p><p>{{evVariable}}</p>
              </div>
            </div>
            <div class="col-md-2">
              <p ng-repeat="(portName, port) in service.breed.ports">
                <a  ui-sref="readOneGateway({id: '{{$ctrl.data.name}}/{{clustername}}/{{portName}}'})" href="">{{portName}}</a>
              </p>
            </div>

            <div class="col-md-1">
              <div class="deploy-status" ng-class="{'yellow': service.state.step.name === 'Initiated', 'green': service.state.step.name === 'Done', 'red': service.state.step.name === 'Failed'}"></div>
              <p class="status-text">{{service.state.intention}} {{service.state.step.name}}</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>