<header title="Deployment" title-addition="{{$ctrl.data.name}}">

</header>

<div class="container-fluid" ng-show="$ctrl.data">
  <div class="row chart-row">
    <!--<live-bar-chart class="col-md-8" ng-if="$ctrl.data.name" base="deployments:{{$ctrl.data.name}}" bar-width="60"></live-bar-chart>-->
    <div class="col-md-6">
      <h4>&nbsp;Health (%)</h4>
      <canvas id="bar" class="chart chart-bar"
              chart-data="$ctrl.chart.data" chart-options="$ctrl.chart.options" chart-labels="$ctrl.chart.labels" chart-series="$ctrl.chart.series" chart-colors="$ctrl.chart.colors">
      </canvas>

    </div>

    <div class="status-col">
      <status value="$ctrl.currentHealth"></status>
      <h3>{{$ctrl.currentHealth | number: 0}}%</h3>
    </div>
  </div>

  <div class="row">
    <div class="col-md-12">
      <div class="panel panel-default" ng-repeat="(clustername, cluster) in $ctrl.data.clusters">
        <div class="panel-heading">
          <div class="row">
            <div class="col-md-3 column">
              <span class="head">{{clustername}}</span>
              &nbsp;
              <span class="category">Cluster</span>
            </div>
            <div class="col-md-3 column">
              <span class="panel-label">Scale</span>
            </div>
            <div class="col-md-3 column">
              <span class="panel-label">Instances</span>
            </div>
            <div class="col-md-3 column">
              <span class="panel-label">Status</span>
            </div>
          </div>
        </div>

        <div class="panel-body">
          <div class="row" ng-repeat="service in cluster.services">
            <div class="col-md-3">
              <p class="head">{{service.breed.name}}</p>
              <p class="sub-head">
                {{service.breed.deployable.type}}:&nbsp;
                {{service.breed.deployable.definition}}
              </p>
            </div>
            <div class="col-md-3">
              <p>
                <span class="panel-label">Instances: </span>

                <span ng-hide="$ctrl.editInstances[service.breed.name]">
                  {{service.scale.instances}}&nbsp;
                  <i ng-click="$ctrl.editNumberOfInstances(service.breed.name, service.scale.instances)" class="fa fa-pencil" aria-hidden="true"></i>
                </span>

                <span ng-show="$ctrl.editInstances[service.breed.name]">
                  <input class="input-small" maxlength="2" step="1" type="number" min="0" ng-model="$ctrl.initialNumberOfInstances[service.breed.name]">
                  <button ng-click="$ctrl.saveNumberOfInstances(service.breed.name, service.scale, $ctrl.initialNumberOfInstances[service.breed.name])">
                    <i class="fa fa-check"></i>
                  </button>
                  <button ng-click="$ctrl.editInstances[service.breed.name] = false; $ctrl.editCancel()">
                    <i class="fa fa-times"></i>
                  </button>
                </span>
              </p>

              <p>
                <span class="panel-label">Cpu: </span>

                <span ng-hide="$ctrl.editCpu[service.breed.name]">
                  {{service.scale.cpu}}&nbsp;
                  <i ng-click="$ctrl.editNumberOfCpus(service.breed.name, service.scale.cpu)" class="fa fa-pencil" aria-hidden="true"></i>
                </span>

                <span ng-show="$ctrl.editCpu[service.breed.name]">
                  <input class="input-small" maxlength="4" step="0.1" type="number" min="0" ng-model="$ctrl.initialNumberOfCpus[service.breed.name]">
                  <button ng-click="$ctrl.saveNumberOfCpus(service.breed.name, service.scale, $ctrl.initialNumberOfCpus[service.breed.name])">
                    <i class="fa fa-check"></i>
                  </button>
                  <button ng-click="$ctrl.editCpu[service.breed.name] = false; $ctrl.editCancel()">
                    <i class="fa fa-times"></i>
                  </button>
                </span>
              </p>
              <p>
                <span class="panel-label">Memory: </span>

                <span ng-hide="$ctrl.editMemory[service.breed.name]">
                  {{service.scale.memory}}&nbsp;
                  <i ng-click="$ctrl.editSizeOfMemory(service.breed.name, service.scale.memory)" class="fa fa-pencil" aria-hidden="true"></i>
                </span>

                <span ng-show="$ctrl.editMemory[service.breed.name]">
                  <input  maxlength="10" size="10" type="input" min="0" ng-model="$ctrl.initialSizeOfMemory[service.breed.name]">
                  <button ng-click="$ctrl.saveSizeOfMemory(service.breed.name, service.scale, $ctrl.initialSizeOfMemory[service.breed.name])">
                    <i class="fa fa-check"></i>
                  </button>
                  <button ng-click="$ctrl.editMemory[service.breed.name] = false; $ctrl.editCancel()">
                    <i class="fa fa-times"></i>
                  </button>
                </span>
              </p>

            </div>
            <div class="col-md-3">
              <p ng-repeat="instance in service.instances">{{instance.host}}</p>
            </div>
            <div class="col-md-3">
              <div>
                <h2 class="text-warning">{{service.state.intention}} {{service.state.step.name}}</h2>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>