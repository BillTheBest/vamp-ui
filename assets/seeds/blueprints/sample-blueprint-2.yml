name: monarchs:1.5
endpoints:
  frontend.port: 9040/http
clusters:
  frontend:
    services:
    - breed:
        name: monarch_front:0.1
        deployable: docker://magneticio/monarch:0.1
        ports:
          port: 8080/http
        environment_variables:
          backend[BACKEND]: http://$backend.host:$backend.ports.port/api/message
        constants: {}
        dependencies:
          backend:
            name: monarch_backend:0.1
      scale:
        cpu: 0.5
        memory: 128.0
        instances: 1
      routing:
        weight: 75
        filters:
        - condition: user-agent != ios
      dialects: {}
    - breed:
        name: monarch_front:0.3
        deployable: docker://magneticio/monarch:0.1
        ports:
          port: 8080/http
        environment_variables:
          backend[BACKEND]: http://$backend.host:$backend.ports.port/api/message
        constants: {}
        dependencies:
          backend:
            name: monarch_backend:0.1
      scale:
        cpu: 0.5
        memory: 128.0
        instances: 1
      routing:
        weight: 10
        filters:
      dialects: {}
    - breed:
        name: monarch_front:0.4
        deployable: docker://magneticio/monarch:0.1
        ports:
          port: 8080/http
        environment_variables:
          backend[BACKEND]: http://$backend.host:$backend.ports.port/api/message
        constants: {}
        dependencies:
          backend:
            name: monarch_backend:0.1
      scale:
        cpu: 0.5
        memory: 128.0
        instances: 1
      routing:
        weight: 10
        filters:
      dialects: {}        
    - breed:
        name: monarch_front:0.2
        deployable: docker://magneticio/monarch:0.2
        ports:
          port: 8080/http
        environment_variables: {}
        constants: {}
        dependencies: {}
      scale:
        cpu: 0.5
        memory: 256.0
        instances: 1
      routing:
        weight: 5
        filters:
        - condition: user-agent != ios
      dialects: {}
    sla:
      type: response_time_sliding_window
      window:
        interval: 600
        cooldown: 600
      threshold:
        upper: 1000
        lower: 100
      escalations:
      - type: to_one
        escalations:
        - type: scale_instances
          target: backend
          minimum: 1
          maximum: 3
          scale_by: 1
        - type: scale_instances
          target: frontend
          minimum: 1
          maximum: 3
          scale_by: 1
    dialects: {}
  backend:
    services:
    - breed:
        name: monarch_backend:0.1
        deployable: docker://magneticio/monarch:0.2
        ports:
          port: 8080/http
        environment_variables: {}
        constants: {}
        dependencies: {}
      dialects: {}
    dialects: {}
environment_variables: {}
